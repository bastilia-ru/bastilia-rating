resources:
- ../base
namespace: bastilia-rating-prod
configMapGenerator:
- envs:
  - .env
  name: bastilia-rating-config
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
labels:
- includeSelectors: true
  pairs:
    managed-by-kustomize: "true"
patches:
- patch: |-
    - op: replace
      path: /spec/rules/0/host
      value: rating.bastilia.ru
    - op: replace
      path: /spec/tls/0/hosts/0
      value: rating.bastilia.ru
    - op: add
      path: /spec/tls/0/hosts/1
      value: www.rating.bastilia.ru
    - op: replace
      path: /spec/tls/0/secretName
      value: bastilia-rating-tls
    - op: add
      path: "/metadata/annotations/nginx.ingress.kubernetes.io~1from-to-www-redirect"
      value: true
  target:
    group: networking.k8s.io
    kind: Ingress
    name: bastilia-rating
    version: v1
- patch: |-
    - op: remove #Remove CPU limits to reduce latency
      path: /spec/template/spec/containers/0/resources/limits/cpu
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/cpu
      value: 200m
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/memory
      value: 256Mi
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/memory
      value: 256Mi
  target:
    group: apps
    kind: Deployment
    name: bastilia-rating
    version: v1
- patch: |-
    - op: replace
      path: /spec/minAvailable
      value: 1
  target:
    group: policy
    kind: PodDisruptionBudget
    name: bastilia-rating
    version: v1
